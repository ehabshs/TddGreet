'use strict';

const fs = require('fs');
const path = require('path');
const chalk = require('chalk');
const mkdirp = require('mkdirp');
const leftPad = require('left-pad');

const ops = {
  CREATED: chalk.green('create'),
  MODIFIED: chalk.green('write'),
  UNCHANGED: chalk.yellow('unchanged'),
};

function normalize(str) {
  return str.replace(/\r\n/g, '\n').trim();
}

module.exports = function (name, data) {
  let op = ops.CREATED;
  mkdirp.sync(path.dirname(name));
  if (fs.existsSync(name)) {
    const old = fs.readFileSync(name).toString();
    op = normalize(old) === normalize(data) ? ops.UNCHANGED : ops.MODIFIED;
  }

  const max = Object.keys(ops).map(x => ops[x].length).reduce((prev, x) => Math.max(prev, x));
  console.log(leftPad(op, max) + ' ' + chalk.white(name));
  fs.writeFileSync(name, data);
};
